<link href="../bower_components/polymer/polymer.html" rel="import">
<link href="../bower_components/iron-signals/iron-signals.html" rel="import">
<link href="../bower_components/paper-card/paper-card.html" rel="import">
<link href="/bower_components/paper-icon-button/paper-icon-button.html" rel="import">
<link href="../bower_components/iron-icons/iron-icons.html" rel="import">
<link href="../bower_components/iron-icons/social-icons.html" rel="import">
<link href="../layouts/layout-main.html" rel="import">
<link href="../bower_components/marked-element/marked-element.html" rel="import">

<dom-module id="snippets-page">
    <template>
        <style>
            .snippets-item {
                width:100%;
                padding: 10px 15px;
                margin-bottom: 20px;
            }
            .snippets-item .header a {
                font-size:18px;
                font-weight: bold;
                margin: 0 0 15px 0;
            }
            .snippets-item .header .action-button {
                float: right;
            }
        </style>
        <layout-main activepage="home" tool-buttons="{{toolButtons}}">

                <template is="dom-repeat" items="{{snippets}}" as="item">
                    <paper-card class="snippets-item">
                        <div class="header">
                            <a is="pushstate-anchor" href="#/snippet/{{item.objectId}}">{{item.title}}</a>
                            <div class="action-button view" on-click="showSnippet"><paper-icon-button icon="icons:open-in-new"></paper-icon-button></div>
                            <paper-icon-button class="action-button" icon="social:share"></paper-icon-button>
                        </div>
                        <marked-element markdown="{{item.description}}">
                            <div class="markdown-html"></div>
                        </marked-element>
                    </paper-card>
                </template>

        </layout-main>
    </template>

    <script>
        Polymer({
            is: 'snippets-page',
            ready: function () {
                var self = this;
                var snippets = [];
                var Snippet = Parse.Object.extend('Snippet');
                var query = new Parse.Query(Snippet);
                query.equalTo("author", Parse.User.current());
                query.find({
                    success: function (results) {
                        query.each(function (snippet) {
                            snippets.push(snippet.toJSON());
                        }).then(function () {
                            self.snippets = snippets;
                        });
                    },
                    error: function (error) {
                        self.fire('iron-signal', {name: 'show-error-message', data: error.message});
                    }
                });
                self.toolButtons = [
                    {name:'Add',icon:'icons:add',handler:this.addSnippet.bind(this)}
                ];
            },
            showSnippet: function(e) {
                location.href = '#/snippet/'+ e.model.item.objectId;
            },
            addSnippet: function() {
                location.href = '#/snippet/';
            }
        });
    </script>
</dom-module>