<link href="../bower_components/polymer/polymer.html" rel="import">
<link href="../bower_components/iron-signals/iron-signals.html" rel="import">
<link href="../bower_components/paper-card/paper-card.html" rel="import">
<link href="../elements/app-markdown-view.html" rel="import">
<link href="../layouts/layout-main.html" rel="import">

<dom-module id="snippets-page">
    <template>
        <style>
            .snippets-item {
                width:100%;
                padding: 10px 15px;
                margin-bottom: 20px;
            }
        </style>
        <layout-main activepage="home">
            <template id="list" is="dom-bind">
                <template is="dom-repeat" items="{{snippets}}" as="item">
                    <paper-card class="snippets-item">
                        <h1><a is="pushstate-anchor" href="#/snippet/{{item.objectId}}">{{item.title}}</a></h1>
                        <div><app-markdown-view>{{item.description}}</app-markdown-view></div>
                    </paper-card>
                </template>
            </template>
        </layout-main>
    </template>

    <script>
        Polymer({
            is: 'snippets-page',
            ready: function () {
                var self = this;
                var snippets = [];
                var Snippet = Parse.Object.extend('Snippet');
                var query = new Parse.Query(Snippet);
                query.equalTo("author", Parse.User.current());
                query.find({
                    success: function (results) {
                        query.each(function (snippet) {
                            snippets.push(snippet.toJSON());
                        }).then(function () {
                            self.$.list.snippets = snippets;
                        });
                    },
                    error: function (error) {
                        self.fire('iron-signal', {name: 'show-error-message', data: error.message});
                    }
                })
            }
        });
    </script>
</dom-module>